<!DOCTYPE html>
<html>
<body>
<div>
<h1>Live table</h1>
<button id="button1" value="Addline">Add line</button>
<button id="button2" value="Delline">Delete line</button>
<button id="button4" value="More">+</button>
<button id="button5" value="Less">-</button>
<table id="table"></table>
<h2>Users</h2>
<textarea id="first"  style="width:600px;" rows="10"></textarea>
</div>
<div id="usersconnections">
<textarea id="second"  style="width:200px;" rows="5"></textarea>
</div>
<div>
  <select  id="colour">
      <option value="">- Choose colour -</option>
       <option value="1">black</option>
       <option value="2">red</option>
       <option value="3">blue</option>                          
 </select>
 <button id="button3" value="changeColour">Change for All users</button>
</div>
<style>
input { border: 1px solid green; width: 80px; }
#usersconnections { float:right; margin-top: -400px;  }
</style>
<script>
  var line=5;
  var w=80;
  var h=17;
  var table = document.getElementById('table');
  var cells = {};
  var letters = ['A', 'B', 'C', 'D', 'E', 'F'];
 

  var tr;
  tr = document.createElement('tr');

  tr.innerHTML = '<td></td>' + letters.map(function(col) {
    return '<td>' + col + '</td>';
  }).join('');
  table.appendChild(tr);

  for (var i = 1; i <= 5; i++) {
    tr = document.createElement('tr');
    tr.innerHTML = '<td>' + i + '</td>' + letters.map(function(col) {
      return '<td><input id="' + col + i + '" type="text"></td>';
    }).join('');
    table.appendChild(tr);
    letters.forEach(function(col) {
      var cell = col + i;
      var input = document.getElementById(cell);
      input.addEventListener('keyup', keyup);
      
      cells[cell] = input;
    });
  }

  var button1 = document.getElementById('button1');
  var button2 = document.getElementById('button2');
  var colour = document.getElementById('colour');  
  var button3 = document.getElementById('button3');
  var button4 = document.getElementById('button4');
  var button5 = document.getElementById('button5');

  function addUser(cell,client){
      document.getElementById('first').value += 'Cell ' + cell + ' was modifed by ' + client +' IP' + '\n';

  }
  
function addConnection(client){
      document.getElementById('second').value += 'Cconnected User with ' + client +' IP ' + '\n';
  }

  function keyup(event) {
    socket.send(JSON.stringify({
      cell: event.target.id,
      value: event.target.value
    }));
  }

  button1.addEventListener('click', function(event) {
     socket.send(JSON.stringify({
      cell: event.target.id,
      value: event.target.value
    }));
     } );

  button2.addEventListener('click', function(event) {
     socket.send(JSON.stringify({
      cell: event.target.id,
      value: event.target.id
    }));
     } );
    
     

  colour.addEventListener('click',function(event){
    console.log(event.target.value);
    switch (event.target.value) {
    case ("1") : table.style.backgroundColor = '#070707'; break;;
    case ("2") : table.style.backgroundColor = '#F10C1D';break;;
    case ("3") : table.style.backgroundColor = '#160CF1';break;;
    case ("4") : table.style.backgroundColor = '#E5E5E5';break;;
    case ("5") : table.style.backgroundColor = '#E5E5E5';break;;
  }
    });

   button3.addEventListener('click', function(event) {
     socket.send(JSON.stringify({
      cell: event.target.id,
      value: table.style.backgroundColor
    }));
     } );
  
   button4.onclick = function(){
    w=w+10; h+=5;
    for (var i = 1; i <= line; i++) {
     tr = document.createElement('tr');
    letters.forEach(function(col) {
      var cell = col + i;
      var input = document.getElementById(cell);
      input.style.width = w + 'px';
      input.style.height = h + 'px';

      cells[cell] = input;
    });
  }
   }

button5.onclick = function(){
    w=w-10; h-=5;
    for (var i = 1; i <= line; i++) {
     tr = document.createElement('tr');
    letters.forEach(function(col) {
      var cell = col + i;
      var input = document.getElementById(cell);
      input.style.width = w + 'px';
      input.style.height = h + 'px';

      cells[cell] = input;
    });
  }
   }



  function addline(){
    line++;
    tr = document.createElement('tr');
    tr.innerHTML = '<td>' + line + '</td>' + letters.map(function(col) {
      return '<td><input id="' + col + line + '" type="text"></td>';
    }).join('');
    table.appendChild(tr);
    letters.forEach(function(col) {
      var cell = col + line;
      var input = document.getElementById(cell);
      input.addEventListener('keyup', keyup);
      input.style.width = w + 'px';
      input.style.height = h + 'px';
      cells[cell] = input;
    });
  }

  function changeTable(hash,client){
      table.style.backgroundColor = hash;
      document.getElementById('first').value += 'Table was modefied by ' + client +' IP' + '\n';

  }

  function popline(){
 document.getElementById('table').deleteRow(line);
line--;
    }

  var socket = new WebSocket('ws://127.0.0.1/');
  var user;
  socket.onmessage = function(event) {
    var change = JSON.parse(event.data);
    if (change.cell=='button1'){ console.log('button1');  addline(); };
    if (change.cell=='button2'){ console.log('button2'); popline();   };
    if (!change.cell) addConnection(change);
    if (change.cell=='button3') { console.log('button3');changeTable(change.value,change.user) }
    if(change.cell!='button1' &&change.cell!='button2'){
    var cell = cells[change.cell];
    cell.value = change.value;
    user = change.user;
    addUser(change.cell,user);
  }
  };

</script>
</body>
</html>